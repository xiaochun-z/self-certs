name: selfcerts-${APP_PROD_TAG:-prod}

services:
  # ============================
  # 1. 应用服务 (Frontend + Backend)
  # ============================
  app:
    image: ${REGISTRY:-registry.app.shenhe.org}/selfcerts:${APP_VER_TAG:-latest}
    container_name: selfcerts-${APP_PROD_TAG:-prod}-app
    restart: unless-stopped
    ports:
      - "${APP_WEB_PORT:-8083}:80"
    volumes:
      - /data/docker/selfcerts:/app/data
    environment:
      - ConnectionStrings__DefaultConnection=Data Source=/app/data/selfcerts.db
      - Logging__LogLevel__Default=${APP_LOG_LEVEL:-Information}
      - ASPNETCORE_ENVIRONMENT=Production
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.selfcerts.rule=Host(`selfcerts.app.shenhe.org`)"
      - "traefik.http.routers.selfcerts.entrypoints=websecure,web"
      - "traefik.http.routers.selfcerts.tls=true"
      - "traefik.http.services.selfcerts.loadbalancer.server.port=${APP_WEB_PORT:-8083}"
    networks:
      - traefik-net

networks:
    traefik-net:
      external: true
      name: traefik-network